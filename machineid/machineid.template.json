{
  "hal_dongle_serialno": "${node_config.serial_number}",
  "hal_volume_type": "${cluster_config.data_disk_type}",
  "devices": ${jsonencode(devices)}
  %{ if node_number == 0 }
  ,
  "acs_config": {
    "join_mode": "auto",
    "internal_networking": {
      "internal_interfaces": [
        {
          "interface": "int-a",
          "netmask": "${internal_network_config.network_mask}",
          "ip_address_ranges": [
            {
              "high": "${internal_network_config.high_ip}",
              "low": "${internal_network_config.low_ip}"
            }
          ]
        }
      ],
      "internal_mtu": 9001
    },
    "external_networking" : {
      "external_interfaces": [
        {
          "interface": "ext-1",
          "netmask": "${external_network_config.network_mask}",
          "gateway": "${external_network_config.gateway_ip}",
          "ip_address_ranges": [
            {
              "high": "${external_ip}",
              "low": "${external_ip}"
            }
          ],
          "mtu": 1500
        }%{ if mgmt_network_config != null },
        {
          "interface": "mgmt-1",
          "netmask": "${mgmt_network_config.network_mask}",
          "gateway": "${mgmt_network_config.gateway_ip}",
          "ip_address_ranges": [
            {
              "high": "${mgmt_ip}",
              "low": "${mgmt_ip}"
            }
          ],
          "mtu": 1500
        }%{ endif }
      ],
      "dns_servers": ${jsonencode(external_network_config.dns_servers)},
      "dns_domains": ${jsonencode(external_network_config.dns_domains)}
    },
    "cluster": {
      "name": "${cluster_config.name}",
      "acs_version": "${cluster_config.acs_version}",
      "encoding": "utf-8",
      %{ if cluster_config.credentials_hashed == true }
      "credentials_hashed": ${cluster_config.credentials_hashed},
      "password": "${cluster_config.hashed_root_password}",
      "admin_user_password": "${cluster_config.hashed_admin_password}",
      %{ else }
      "password": "${cluster_config.root_password}",
      "admin_user_password": "${cluster_config.admin_password}",
      %{ endif }
      "nodes": ${jsonencode([{"serial_number": node_config.serial_number}])},
      "l3_cache": {
        "ssd_l3_cache_default_enabled": false
      },
      "timezone": {
        "name": "${cluster_config.timezone}"
      },
      "cluster_name_nt4_compatibility": false
    }%{ if mgmt_network_config != null },
    "post_cluster": {
      "post_install_commands": {
        "cmd": "isi net external modify --sbr=true"
      }
    }%{ endif }
  }
  %{ endif }
}
